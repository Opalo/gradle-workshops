task jettyRunExt << {
    runJetty('ext', ' 8082')
}

jettyRunExt.dependsOn(':client:war')
jettyRunExt.dependsOn(':server:ext:war')

task jettyRunInt << {
    runJetty('int', '8084')
}

jettyRunInt.dependsOn(':client:war')
jettyRunInt.dependsOn(':server:int:war')


def runJetty(env, port) {
    def server_war = "server/$env/build/libs/$env-${version}.war"
    def client_war = "client/build/libs/client-${version}.war"

    def jetty_path = ' jetty-runner/jetty-runner-8.1.13.v20130916.jar '
    def jetty_cmd = new StringBuilder()
    jetty_cmd.
            append('java ').
            append(' -jar ').
            append(jetty_path).
            append(' --port ').append("$port ").
            append(' --path ').append("$env ").
            append(server_war).
            append(' --path ').append('client ').
            append(client_war)

    println jetty_cmd.toString()

    def jetty_proc = jetty_cmd.toString().execute()
    jetty_proc.in.eachLine { line -> println "IN: ${line}" }
    jetty_proc.err.eachLine { line -> println "ERROR: ${line}" }
    jetty_proc.waitFor()
}